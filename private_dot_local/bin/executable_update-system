#!/usr/bin/env bash

source /etc/os-release

echo '------ Updating system packages ------'
case $NAME in
'openSUSE Tumbleweed')
	sudo zypper dup
	;;
'Debian GNU/Linux')
	if [ $(command -v nala) ]; then
		sudo nala upgrade
	else
		echo 'nala is not installed, apt-get will be used instead.'
		sudo apt-get update && sudo apt-get upgrade
	fi
	;;
'Fedora Linux')
    sudo dnf upgrade
    ;;
esac

if [ $(command -v flatpak) ]; then
	echo '------ Updating Flatpak apps ------'
	flatpak --user upgrade --assumeyes
fi

if [ $(command -v pipx) ]; then
	echo '------ Updating pipx apps ------'
	pipx upgrade-all
fi

if [ $(command -v cargo) ]; then
	echo '------ Updating global Rust packages ------'
	if [ $(command -v rg) ]; then
		GREP='rg'
	else
		GREP='grep'
	fi

	# Check whether cargo-update is installed.
	if [ -n "$(cargo install --list | $GREP '^cargo-update')" ]; then
		cargo install-update -a
	else
		echo 'cargo-update is not installed, Rust packages will not be updated.'
		echo 'To install cargo update run `cargo install cargo-update`'
	fi
fi
